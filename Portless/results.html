<style>
  .calcDetailTable td {
    padding: 4px;
    min-width: 250px;
    border-bottom: 1px solid grey;
  }
  .calcDetailTable th {
    padding: 12px;
    min-width: 250px;

    background-color: #f2f2f2;
  }
  .calcDetailTable .price {
    text-align: center;
  }
  .calcDetailTable .total td {
    padding: 1rem 4px;
    font-size: 1.2rem;
  }
</style>
<script>
  // **************** CONST ****************
  let curency = '$ '
  const VOLUMETRIC_WEIGHT_RATIO_METRIC = 5000
  const VOLUMETRIC_WEIGHT_RATIO_IMPERIAL = 305

  // **************** DOM ELEMENTS ****************
  const calcDetailsWrap = document.getElementById('calc_details-wrap')

  // **************** INPUT DATA ****************
  const totalPrice = sessionStorage.getItem('totalPrice')
  let dataInputs = JSON.parse(sessionStorage.getItem('dataInputs'))
  console.log(dataInputs)
  let dataCalculations = JSON.parse(sessionStorage.getItem('dataCalculations'))
  console.log(dataCalculations)
  // go trough  dataCalculations object and pull all values trough Math.round((num + Number.EPSILON) * 100) / 100
  for (let key in dataCalculations) {
    dataCalculations[key] = (
      Math.round((parseFloat(dataCalculations[key]) + Number.EPSILON) * 100) /
      100
    ).toFixed(2)
  }

  // **************** DISPLAY DATA ****************
  let calcDetails = `
  <table class="calcDetailTable">
  <tr><th colspan="2">Fulfillment costs per item</th><th>Traditional method</th></tr>  
  <tr><td rowspan="12">Freight Costs</td><td>Ocean Freight (Container Cost)</td><td class="price">${curency}${dataCalculations.oceanFreight}</td></tr>
  <tr><td>Importer Security Filing & Bond</td><td class="price">${curency}${dataCalculations.importerSecurityFilingBondCalculated}</td></tr>
  <tr><td>Handling Fee</td><td class="price">${curency}${dataCalculations.handlingFeeCalculated}</td></tr>
  <tr><td>Drayage</td><td class="price">${curency}${dataCalculations.drayageCalculated}</td></tr>
  <tr><td>Chassis</td><td class="price">${curency}${dataCalculations.chassisCalculated}</td></tr>
  <tr><td>Congestion Fee</td><td class="price">${curency}${dataCalculations.congestionFeeCalculated}</td></tr>
  <tr><td>Security Surcharge</td><td class="price">${curency}${dataCalculations.securitySurchargeCalculated}</td></tr>
  <tr><td>Inland Fuel Surcharge</td><td class="price">${curency}${dataCalculations.inlandFuelSurchargeCalculated}</td></tr>
  <tr><td>Hazmat</td><td class="price">${curency}${dataCalculations.hazmatCalculated}</td></tr>
  <tr><td>Delivery</td><td class="price">${curency}${dataCalculations.deliveryCalculated}</td></tr>
  <tr><td>Detention Fee</td><td class="price">${curency}${dataCalculations.detentionFeeCalculated}</td></tr>
  <tr><td>Pre-Pull</td><td class="price">${curency}${dataCalculations.prePullCalculated}</td></tr>
  <tr><td>Air Freight</td><td></td><td class="price">${curency}${dataCalculations.airFreightCalculated}</td></tr>
  <tr><td rowspan="2">Customs Costs</td><td>Customs / Tariff Rate</td><td class="price">${curency}${dataCalculations.customsTarifRate}</td></tr>
  <tr><td>Custom Clearance</td><td class="price">${curency}${dataCalculations.customsClearanceCalculated}</td></tr>
  <tr><td rowspan="6">3PL / Shipping Fees</td><td>Monthly Account Fee</td><td class="price">${curency}${dataCalculations.monthlyAccountFee}</td></tr>
  <tr><td>Receiving / Inbound Fee</td><td class="price">${curency}${dataCalculations.receivingInboundFee}</td></tr>
  <tr><td>Storage / Warehousing Fee</td><td class="price">${curency}${dataCalculations.storageWarehouseFee}</td></tr>
  <tr><td>Pick & Pack Fee</td><td class="price">${curency}${dataCalculations.pickPackPerOrder}</td></tr>
  <tr><td>Material Fees</td><td class="price">${curency}${dataCalculations.materiialsFeePerOrder}</td></tr>
  <tr><td>Shipping Cost</td><td class="price">${curency}${dataCalculations.averageShippingCostPerOrder}</td></tr>
  <tr><td rowspan="2">Indirect Costs</td><td>Inventory Financing Cost</td><td class="price">${curency}${dataCalculations.inventoryFinancingCost}</td></tr>
  <tr><td>Overstock Cost</td><td class="price">${curency}${dataCalculations.overstockCost}</td></tr>
  <tr class="total"><td><strong>Totals</strong></td><td><strong>Total Price / Order</strong></td><td class="price"><strong>${curency}${totalPrice}</strong></td></tr>
  </table>
  `
  calcDetailsWrap.innerHTML = calcDetails

  // **************** PORTLESS INPUT TABLE ****************

  const portlessInputTable = [
    {
      min: 0,
      max: 0.25,
      price: 4.72
    },
    {
      min: 0.25,
      max: 0.5,
      price: 6.33
    },
    {
      min: 0.5,
      max: 0.75,
      price: 7.94
    },
    {
      min: 0.75,
      max: 0.99,
      price: 8.83
    },
    {
      min: 1,
      max: 1.25,
      price: 9.34
    },
    {
      min: 1.25,
      max: 1.5,
      price: 10.91
    },
    {
      min: 1.5,
      max: 1.75,
      price: 12.21
    },
    {
      min: 1.75,
      max: 2,
      price: 13.74
    },
    {
      min: 2,
      max: 2.25,
      price: 15.27
    },
    {
      min: 2.25,
      max: 2.5,
      price: 16.8
    },
    {
      min: 2.5,
      max: 2.75,
      price: 18.33
    },
    {
      min: 2.75,
      max: 3,
      price: 19.86
    },
    {
      min: 3,
      max: 3.25,
      price: 21.39
    },
    {
      min: 3.25,
      max: 3.5,
      price: 22.92
    },
    {
      min: 3.5,
      max: 3.75,
      price: 24.45
    },
    {
      min: 3.75,
      max: 4,
      price: 25.98
    },
    {
      min: 4,
      max: 4.25,
      price: 27.51
    },
    {
      min: 4.25,
      max: 4.5,
      price: 26.92
    },
    {
      min: 4.5,
      max: 4.75,
      price: 28.33
    },
    {
      min: 4.75,
      max: 5,
      price: 29.75
    },
    {
      min: 5,
      max: 5.25,
      price: 31.16
    },
    {
      min: 5.25,
      max: 5.5,
      price: 32.57
    },
    {
      min: 5.5,
      max: 5.75,
      price: 33.98
    },
    {
      min: 5.75,
      max: 6,
      price: 35.4
    },
    {
      min: 6,
      max: 6.25,
      price: 36.81
    },
    {
      min: 6.25,
      max: 6.5,
      price: 38.22
    },
    {
      min: 6.5,
      max: 6.75,
      price: 39.63
    },
    {
      min: 6.75,
      max: 7,
      price: 41.05
    },
    {
      min: 7,
      max: 7.25,
      price: 42.46
    },
    {
      min: 7.25,
      max: 7.5,
      price: 43.87
    },
    {
      min: 7.5,
      max: 7.75,
      price: 45.28
    },
    {
      min: 7.75,
      max: 8,
      price: 46.7
    },
    {
      min: 8,
      max: 8.25,
      price: 48.11
    },
    {
      min: 8.25,
      max: 8.5,
      price: 49.52
    },
    {
      min: 8.5,
      max: 8.75,
      price: 50.93
    },
    {
      min: 8.75,
      max: 9,
      price: 52.34
    },
    {
      min: 9,
      max: 9.25,
      price: 53.76
    },
    {
      min: 9.25,
      max: 9.5,
      price: 55.17
    },
    {
      min: 9.5,
      max: 9.75,
      price: 56.58
    },
    {
      min: 9.75,
      max: 10,
      price: 57.99
    }
  ]

  // take width, height and lemgth from dataInputs and calculate volumetric weight. dimension units are in dataInputs.unitType (metric or imperial), inches or cm, so kalkulate in kg or lbs
  let volumetricWeight = 0
  if (dataInputs.unitType === 'metric') {
    volumetricWeight =
      (dataInputs.itemWidth * dataInputs.itemHeight * dataInputs.itemLength) /
      VOLUMETRIC_WEIGHT_RATIO_METRIC
  } else {
    volumetricWeight =
      (dataInputs.itemWidth * dataInputs.itemHeight * dataInputs.itemLength) /
      VOLUMETRIC_WEIGHT_RATIO_IMPERIAL
  }

  let weightFromUserInput
  if (dataInputs.unitType === 'imperial') {
    weightFromUserInput = dataInputs.itemWeight
  } else {
    weightFromUserInput = dataInputs.itemWeight * 2.20462
  }

  let itemWeightCalculated
  if (volumetricWeight > weightFromUserInput) {
    itemWeightCalculated = volumetricWeight
  } else {
    itemWeightCalculated = weightFromUserInput
  }

  // take value from itemWeightCalculated and find matching price in portlessInputTable. if no maching price set price to -1
  let portlessPrice = -1
  for (let i = 0; i < portlessInputTable.length; i++) {
    if (
      itemWeightCalculated > portlessInputTable[i].min &&
      itemWeightCalculated <= portlessInputTable[i].max
    ) {
      portlessPrice = portlessInputTable[i].price
    }
  }

  // **************** LOG ****************
  console.log('dataInputs.unitType', dataInputs.unitType)
  console.log('dataInputs.itemWidth', dataInputs.itemWidth)
  console.log('dataInputs.itemHeight', dataInputs.itemHeight)
  console.log('dataInputs.itemLength', dataInputs.itemLength)
  console.log('volumetricWeight', volumetricWeight)
  console.log('dataInputs.itemWeight', dataInputs.itemWeight)
  console.log('===================================================')
  console.log('itemWeightCalculated', itemWeightCalculated)
  console.log('portlessPrice', portlessPrice)
</script>
